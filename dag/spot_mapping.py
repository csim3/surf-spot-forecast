"""One-to-one mapping between each location's alphanumeric ID and common name.

"SPOTS" variable string provided by 
https://github.com/swrobel/meta-surf-forecast/blob/main/db/seeds.rb
Additional location metadata (subregion and region) is fetched for each spot.
"""

import pandas as pd
import re

SPOTS = """{ subregion: QU,
    surfline_v2_id: '5842041f4e65fad6a7708852',
    name: '90th St. Rockaways' },
  { subregion: QU,
    surfline_v2_id: '584204214e65fad6a7709d0a',
    name: '77th St. Rockaways' },
  { subregion: NOC,
    lon: -118.107874753501,
    lat: 33.7377190285934,
    surfline_v1_id: 4217,
    surfline_v2_id: '5842041f4e65fad6a7708820',
    msw_id: 285,
    spitcast_id: 222,
    spitcast_slug: 'seal-beach-pier-seal-beach-ca',
    name: 'Seal Beach Pier' },
  { subregion: NOC,
    lon: -118.103408,
    lat: 33.736816,
    surfline_v1_id: 4865,
    surfline_v2_id: '5842041f4e65fad6a77088e4',
    msw_id: 2599,
    name: '13th St Seal Beach' },
  { subregion: NOC,
    lon: -118.09080856603,
    lat: 33.7284858046428,
    surfline_v1_id: 4867,
    surfline_v2_id: '5842041f4e65fad6a77088e7',
    msw_id: 2594,
    spitcast_id: 602,
    spitcast_slug: 'surfside-jetty-north-coast-ca',
    name: 'Surfside Jetty' },
  { subregion: NOC,
    lon: -118.080226173689,
    lat: 33.7231577185346,
    surfline_v1_id: 4219,
    surfline_v2_id: '5842041f4e65fad6a7708822',
    msw_id: 4898,
    spitcast_id: 603,
    spitcast_slug: 'anderson-st-north-coast-ca',
    name: 'Anderson St' },
  { subregion: NOC,
    lon: -118.040365824134,
    lat: 33.6853921593044,
    surfline_v1_id: 103685,
    surfline_v2_id: '584204204e65fad6a770998d',
    msw_id: 3797,
    spitcast_id: 604,
    spitcast_slug: 'bolsa-chica-huntington-beach-ca',
    name: 'Bolsa Chica' },
  { subregion: NOC,
    lon: -118.01901000164,
    lat: 33.6661562058152,
    surfline_v1_id: 4870,
    surfline_v2_id: '5842041f4e65fad6a77088ea',
    msw_id: 4039,
    spitcast_id: 220,
    spitcast_slug: 'goldenwest-huntington-beach-ca',
    name: 'Goldenwest' },
  { subregion: NOC,
    lon: -118.014049033956,
    lat: 33.6639452812659,
    surfline_v1_id: 4871,
    surfline_v2_id: '5842041f4e65fad6a77088eb',
    msw_id: 4896,
    spitcast_id: 605,
    spitcast_slug: '17th-street-huntington-beach-ca',
    name: '17th St Huntington' },
  { subregion: NOC,
    lon: -118.005043340881,
    lat: 33.6552139815928,
    surfline_v1_id: 4223,
    surfline_v2_id: '5842041f4e65fad6a7708827',
    msw_id: 286,
    spitcast_id: 221,
    spitcast_slug: 'huntington-pier-huntington-beach-ca',
    name: 'Huntington Pier' },
  { subregion: NOC,
    lon: -117.993221421263,
    lat: 33.6485165540874,
    surfline_v1_id: 4875,
    surfline_v2_id: '5842041f4e65fad6a77088ee',
    msw_id: 4895,
    spitcast_id: 643,
    spitcast_slug: 'huntington-beach-huntington-beach-ca',
    name: 'Huntington State Beach' },
  { subregion: NOC,
    lon: -117.959168,
    lat: 33.628085,
    surfline_v1_id: 103681,
    surfline_v2_id: '584204204e65fad6a770998c',
    msw_id: 2577,
    spitcast_id: 606,
    spitcast_slug: 'santa-ana-river-jetties-newport-beach-ca',
    name: 'Santa Ana River Jetties' },
  { subregion: NOC,
    lon: -117.948767376086,
    lat: 33.6229055807335,
    surfline_v1_id: 43103,
    surfline_v2_id: '5842041f4e65fad6a7708e54',
    msw_id: 665,
    spitcast_id: 219,
    spitcast_slug: '56th-street-newport-beach-ca',
    name: '56th St Newport Beach' },
  { subregion: NOC,
    lon: -117.938811422113,
    lat: 33.6172275924874,
    surfline_v1_id: 4225,
    surfline_v2_id: '5a26dd690f87fe001a0c70dc',
    spitcast_id: 607,
    spitcast_slug: '40th-street-newport-beach-ca',
    name: '40th Street' },
  { subregion: NOC,
    lon: -117.936957653326,
    lat: 33.6153190345846,
    surfline_v1_id: 4226,
    surfline_v2_id: '5842041f4e65fad6a770882a',
    msw_id: 4683,
    spitcast_id: 608,
    spitcast_slug: '36th-street-newport-beach-ca',
    name: '36th Street' },
  { subregion: NOC,
    lon: -117.933626701894,
    lat: 33.6109583118254,
    surfline_v1_id: 53412,
    surfline_v2_id: '584204204e65fad6a7709115',
    msw_id: 2575,
    spitcast_id: 651,
    spitcast_slug: 'blackies-newport-beach-ca',
    name: 'Blackies' },
  { subregion: NOC,
    lon: -117.930738451154,
    lat: 33.6066469200425,
    surfline_v1_id: 4227,
    surfline_v2_id: '5842041f4e65fad6a770882c',
    spitcast_id: 609,
    spitcast_slug: 'newport-pier-newport-beach-ca',
    name: 'Newport Pier' },
  { subregion: NOC,
    lon: -117.882342970408,
    lat: 33.5933899386699,
    surfline_v1_id: 4232,
    surfline_v2_id: '5842041f4e65fad6a770882b',
    msw_id: 287,
    spitcast_id: 217,
    spitcast_slug: 'the-wedge-newport-beach-ca',
    name: 'The Wedge' },
  { subregion: NOC,
    lon: -117.875881,
    lat: 33.592468,
    surfline_v1_id: 4879,
    surfline_v2_id: '5842041f4e65fad6a77088f3',
    msw_id: 2579,
    name: 'Corona Del Mar' },
  { subregion: SOC,
    lon: -117.723302388099,
    lat: 33.4746650451478,
    surfline_v1_id: 4233,
    surfline_v2_id: '5842041f4e65fad6a770882e',
    msw_id: 289,
    spitcast_id: 214,
    spitcast_slug: 'salt-creek-dana-point-ca',
    name: 'Salt Creek' },
  { subregion: SOC,
    lon: -117.716886,
    lat: 33.466191,
    surfline_v1_id: 4849,
    surfline_v2_id: '5842041f4e65fad6a77088d5',
    msw_id: 4040,
    name: 'Strands' },
  { subregion: SOC,
    lon: -117.688648571076,
    lat: 33.4603308582054,
    surfline_v1_id: 4848,
    surfline_v2_id: '5842041f4e65fad6a77088d7',
    msw_id: 2588,
    spitcast_id: 213,
    spitcast_slug: 'doheny-dana-point-ca',
    name: 'Doheny' },
  { subregion: SOC,
    lon: -117.621267674113,
    lat: 33.4197319428865,
    msw_id: 290,
    spitcast_id: 212,
    spitcast_slug: 'san-clemente-pier-san-clemente-ca',
    name: 'San Clemente Pier' },
  { subregion: SOC,
    lon: -117.618142936175,
    lat: 33.4159655824035,
    surfline_v1_id: 4235,
    surfline_v2_id: '5842041f4e65fad6a7708830',
    msw_id: 2570,
    spitcast_id: 211,
    spitcast_slug: 't-street-san-clemente-ca',
    name: 'T Street' },
  { subregion: SOC,
    lon: -117.606199616021,
    lat: 33.4029799681431,
    surfline_v1_id: 4843,
    surfline_v2_id: '5842041f4e65fad6a77088cf',
    msw_id: 4900,
    spitcast_id: 392,
    spitcast_slug: 'state-park-san-clemente-ca',
    name: 'San Clemente State Beach' },
  { subregion: SOC,
    lon: -117.598772149192,
    lat: 33.3906129925768,
    surfline_v1_id: 4737,
    surfline_v2_id: '5842041f4e65fad6a7708884',
    msw_id: 4899,
    spitcast_id: 209,
    spitcast_slug: 'cottons-point-san-clemente-ca',
    name: 'Cottons' },
  { subregion: SOC,
    lon: -117.594451124026,
    lat: 33.3844763013776,
    surfline_v1_id: 4738,
    surfline_v2_id: '5842041f4e65fad6a7708887',
    spitcast_id: 623,
    spitcast_slug: 'upper-trestles-san-clemente-ca',
    name: 'Upper Trestles' },
  { subregion: SOC,
    lon: -117.588839746081,
    lat: 33.3821169550733,
    surfline_v1_id: 4740,
    surfline_v2_id: '5842041f4e65fad6a770888a',
    msw_id: 291,
    spitcast_id: 208,
    spitcast_slug: 'lower-trestles-san-clemente-ca',
    name: 'Lower Trestles' },
  { subregion: SOC,
    lon: -117.57903433989,
    lat: 33.3801145547518,
    surfline_v1_id: 4741,
    surfline_v2_id: '5842041f4e65fad6a770888b',
    msw_id: 4901,
    spitcast_id: 625,
    spitcast_slug: 'church-san-clemente-ca',
    name: 'Church' },
  { subregion: SOC,
    lon: -117.569129199378,
    lat: 33.3736054662039,
    surfline_v1_id: 4237,
    surfline_v2_id: '5842041f4e65fad6a7708831',
    msw_id: 4192,
    spitcast_id: 239,
    spitcast_slug: 'san-onofre-san-clemente-ca',
    name: 'San Onofre' },
  { subregion: SOC,
    lon: -117.519084,
    lat: 33.343654,
    surfline_v1_id: 4736,
    surfline_v2_id: '5842041f4e65fad6a7708885',
    msw_id: 2600,
    spitcast_id: 614,
    spitcast_slug: 'trails-san-clemente-ca',
    name: 'Trails' },"""

REGION_DICT = {
    'COL': ('Colima','Mexico'),
    'GUR': ('Guerrero','Mexico'),
    'LA': ('Los Angeles','California'),
    'MNS': ('Maui - North Shore', 'Hawaii'),
    'MNW': ('Maui - Northwest', 'Hawaii'),
    'MSW': ('Maui - Southwest', 'Hawaii'),
    'NOC': ('North Orange County', 'California'),
    'NSD': ('North San Diego', 'California'),
    'NT': ('Namotu/Tavarua', 'Fiji'),
    'ONS': ('Oahu - North Shore', 'Hawaii'),
    'OSS': ('Oahu - South Shore', 'Hawaii'),
    'PT': ('Portugal', 'Europe'),
    'QU': ('Queens', 'New York'),
    'SBVC': ('Santa Barbara/Ventura', 'California'),
    'SC': ('Santa Cruz', 'California'),
    'SF': ('San Francisco', 'California'),
    'SOC': ('South Orange County', 'California'),
    'SSD': ('South San Diego', 'California')
}

SPOTS_LIST = SPOTS.split("{")

def get_spot_mapping_list():
    """Fetches one-to-one mapping between spot_id and spot_name by parsing "SPOTS".

    Returns:
        List: Each element is a dictionary with the two keys "spot_id" and "spot_name".
    """
    id_key = 'surfline_v2_id: '
    name_key = 'name: '
    subregion_key = 'subregion: '
    mapping_list = []

    for spot in SPOTS_LIST:
        if (spot.find(id_key) > -1): #search for items that have a Surfline ID
            
            # +1 to account for starting apostrophe of spot_id in original string
            id_start_pos = spot.find(id_key) + len(id_key) + 1 
            # +1 to account for starting apostrophe of spot_name in original string
            name_start_pos = spot.find(name_key) + len(name_key) + 1 
            # subregion string does not start with apostrophe
            subregion_start_pos = spot.find(subregion_key) + len(subregion_key)
            #spot_name ending is found by minimum of: i. "}" character or ii. "," character
            name_text_length = min(spot[name_start_pos:].find('}') - 2, 
                spot[name_start_pos:].find(',') - 1)
            #RegEx search for alphanumeric spot_id
            spot_id = re.search("^([0-9]|[a-zA-Z])+", spot[id_start_pos:]).group(0) 
            #RegEx search for capital letters abbreviation of subregion
            subregion_abbrev = re.search("^[A-Z]+", spot[subregion_start_pos:]).group(0)
            spot_name = spot[name_start_pos: name_start_pos + name_text_length]
            
            mapping_list.append({'spot_id': spot_id, 'spot_name': spot_name, 
                'subregion_abbrev': subregion_abbrev})
    return mapping_list

def get_spot_mapping_df():
    """Fetches subregion and region of each surf break location.

    Returns:
        DataFrame: Each row is a location with its spot_id, spot_name, subregion, and region.
    """
    mp_list = get_spot_mapping_list()
    for mp in mp_list:
        mp['subregion'] = REGION_DICT[mp['subregion_abbrev']][0]
        mp['region'] = REGION_DICT[mp['subregion_abbrev']][1]
    return pd.DataFrame(mp_list)
